(function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define(["jquery"],t):this.JValidator=t(jQuery)}).call("undefined"!=typeof window?window:this,function(t){function e(t){return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}function i(e){e=e||{},e.root&&(this.root=t(e.root)),this.fields=[],this.status=d.ENABLE,e.msgDom&&(this.msgDom=e.msgDom),t.extend(this.msgNameSpace={},e.messages),this.validateInvisibleFileds=!0,e.beforeShowError&&(this.beforeShowError=e.beforeShowError),e.beforeHideError&&(this.beforeHideError=e.beforeHideError),e.findMsgDom&&(this.findMsgDom=e.findMsgDom),e.msgDomTemplate&&(this.msgDomTemplate=e.msgDomTemplate),this.root&&this.scan(this.root)}function s(e,i){this.jValidator=e,this.errors={totalError:0},this.element=i,this.rules=[],this.allPass=void 0,this.msgDom=this.jValidator.msgDom,this.status=d.ENABLE;var s,r;s=this,r=this.element,r.off("focus.JValidatorFocus").on("focus.JValidatorFocus",function(){s.hideError()}),(r.is(":checkbox")||r.is(":radio"))&&r.off("click.JValidatorClick").on("click.JValidatorClick",function(){s.hideError()}),t(this.element).data("jField",this)}function r(e,i,s,r,n,a,l,h){var c,d=this;this.field=e,this.name=i,this.param=s||[],this.eventType=r||"blur",this.msg=n||this.field.msg,this.msgPlace=(a||[]).concat(this.param),this.method=h;var f,p;if(f=this.field.element,c=l||this.field.msgDom||this.field.jValidator.msgDom||["^",".j-error-msg"],u(c)?(p="^"===c[0]?f.parent():f.closest(c[0]),c=c[1]?p.find(c[1]):p.find(".j-error-msg"),c.length||(o(this.field.jValidator.findMsgDom)?c=this.field.jValidator.findMsgDom(f):(c=t(this.field.jValidator.msgDomTemplate||m),p.append(c)))):c=t(c),this.msgDom=c,this.msgDom.is("label")){var v=this.field.element.attr("id");v||(v=g(),this.field.element.attr("id",v)),this.msgDom.attr("for",v)}this.pass=void 0,this.xhr=null,"submit"!=this.eventType&&(f.is("select")?this.eventType="change blur":(f.is(":checkbox")||f.is(":radio"))&&(this.eventType="click"),f.on(this.eventType+".JValidator",function(){d.validate()}))}function n(t){return t%4===0&&t%100!==0||t%400===0}function a(t,e){return 2===t?n(e)?29:28:Math.ceil(Math.abs(t-7.5))%2+30}var o=e("Function"),l=e("Boolean"),h=e("Object"),u=Array.isArray||e("Array"),c=Array.prototype.slice,d={ENABLE:1,DISABLE:0},f={zipCode:"请输入6位数邮政编码",number:"请填写合适的数字","int":"请填写合适的整数","float":"请填写合适的小数",email:"请输入正确的邮件地址",max:"请填写小于或者等于{0}的数",min:"请填写大于或者等于{0}的数",maxLength:"输入字符长度不得大于{0}",minLength:"输入字符长度不得小于{0}",mobile:"请输入11位数有效手机号码",idCard:"请输入有效的身份证号码",length:"输入字符长度须等于{0}",required:"不能为空",sameTo:"两次输入不致"},m='<span class="j-error-msg" style="display:none"><i class="j-error-icon iconV2 errorIcon"></i><span class="error-content"></span></span>';(function(){this.scan=function(e){var i,n;return i=this,n=t(e),this.root||(this.root=n),n=n.is("[rule]")?n:n.find("[rule]"),n.each(function(){var e,n,a,o,l;e=t(this),a=new s(i,e),n=e.attr("rule"),o=n.split(/\s+/),l=o.pop(),":"===l.charAt(0)?(l=l.replace(/^:/,"").split(":"),a.msg=l[0],a.msgDom=(l[1]||"").split(","),1===a.msgDom.length&&(a.msgDom=a.msgDom[0])):o.push(l),t.each(o,function(t,e){var i,s,n,o,l,h;e=e.replace(/^(\w+)(\||$)/,function(t,e){return i=e,""}),e=e.replace(/([^\*]*)(\*|$)/,function(t,e){return s=e?e.split(","):[],""}),e=e.split(":"),n=e[0]||"blur",e[1]&&(o=e[1].split("|"),l=o[1],o=o[0],l&&(l=l.split(","))),e[2]&&(h=e[2].split(","),1===h.length&&(h=h[0])),e=new r(a,i,s,n,o,l,h),a.rules.push(e)}),i.fields.push(a)}),this},this.remove=function(e){var i=this;t(e).find("[rule]").each(function(){var e=this;t.each(i.fields,function(t,s){return s.element[0]==e?(s.destroy(),i.fields.splice(t,1),!1):void 0})})},this.destroy=function(){var e=this;t.each(e.fields,function(t,e){e.destroy()}),e.disableValidator()},this.validate=function(){var e,i,s=!0;return e=[],this.isEnable()?(t.each(this.fields,function(t,r){var n=r.validate();n===!1?(i||(i=r.element),s=!1):h(n)&&e.push(n)}),e.length>0&&(s=t.when.apply(t,e)),i&&t(document).scrollTop(t(i).offset().top-20),s):!0},this.addRules=function(e){var i,n,a,o,l,h,u,c,d,f;i=this,t.each(e,function(e,m){a=t(m.element),void 0===a.attr("rule")?(a.attr("rule",""),n=new s(i,a),i.fields.push(n)):t.each(i.fields,function(t,e){return e.element[0]==m.element?(n=e,!1):void 0}),o=m.name||g(),h=m.eventType||"submit",l=m.param||[],u=m.msg||n.msg||"",c=m.msgPlace||[],d=m.msgDom||"",f=m.method,n.rules.push(new r(n,o,l,h,u,c,d,f))})},this.wrapSubmit=function(e){function i(e){var i=!0;return h(e[1])?t.each(e,function(t,e){return e.result===!1?i=!1:void 0}):i=e[0].result,i}var s=this;return function(){var t=s.validate();return t?h(t)?t.done(function(){i(c.call(arguments))&&e()}):e():t}},this.enableValidator=function(){this.status=d.ENABLE},this.disableValidator=function(){this.status=d.DISABLE},this.isEnable=function(){return!!this.status},this.setMessage=function(e){t.extend(this.msgNameSpace,e)},this.setMsgDomTemplate=function(t){this.msgDomTemplate=t},this.ignoreFields=function(e){var i=t(e);null!=i.attr("rule")?i.data("jField").ignore():i.find("[rule]").each(function(e,i){t(i).data("jField").ignore()})},this.trackFields=function(e){var i=t(e);null!=i.attr("rule")?i.data("jField").track():i.find("[rule]").each(function(e,i){t(i).data("jField").track()})},this.ignoreInvisibleFields=function(){this.validateInvisibleFileds=!1},this.trackInvisibleFields=function(){this.validateInvisibleFileds=!0},this.beforeShowError=function(){},this.beforeHideError=function(){}}).call(i.prototype),function(){this.registerRule=function(t,e,i,s){if(h(t)?(s=t.overWrite,i=t.message,e=t.callback,t=t.name):l(i)&&(s=i,i=""),p[t]&&!s)throw t+" is exists, can not regist as a rule.";p[t]=e,i&&(f[t]=i)},this.setDefaultMessage=function(e){t.extend(f,e)},this.setMsgDomTemplate=function(t){m=t}}.call(i),function(){this.validate=function(){var e,i=this;return i.allPass=!0,i.isValidatorEnable()?(t.each(i.rules,function(t,s){return e=s.validate(),e!==!0&&(i.allPass=e,i.handleValidateResult(s),e===!1)?!1:void 0}),i.allPass):!0},this.value=function(){return this.element.val()},this.text=function(){return this.element.text()},this.ignore=function(){this.status=d.DISABLE},this.track=function(){this.status=d.ENABLE},this.isIgnored=function(){return this.status===d.DISABLE},this.handleValidateResult=function(t,e){var i,s,r,n;i=this.element,s=t.pass,r=t.name,n=this.errors,s===!0?(n[r]&&n.totalError--,delete n[r],0===n.totalError&&(this.lock=!1,this.hideError(t))):s===!1&&(n[r]||(n[r]=!0,n.totalError++),this.lock||(this.lock=!0,this.showError(t,e)))},this.isValidatorEnable=function(){return this.jValidator.isEnable()},this.showError=function(e,i){var s,r,n,a;s=t(e.msgDom),a=e.name,r=s.find(".error-content"),r.length||(r=s),n=i||e.msg||this.jValidator.msgNameSpace[a]||f[a]||"请正确输入",n=n.replace(/\{([\d+|n])\}/g,function(t,i){return"n"===i?e.msgPlace.join(","):e.msgPlace[i]||""}),r.text(n),this.jValidator.beforeShowError(this.element[0]),this.element.addClass("j-error"),s.show()},this.hideError=function(e){this.jValidator.beforeHideError(this.element[0]),this.errors={totalError:0},this.lock=!1,this.element.removeClass("j-error"),this.rules.forEach(function(e){t(e.msgDom).hide()})},this.root=function(){return this.jValidator.root},this.isCheckbox=function(e){var i,s;return s=t(this.element),i=s.is(":checkbox"),i&&e&&(i=s.attr("name")),i},this.isRadio=function(e){var i,s;return s=t(this.element),i=s.is(":radio"),i&&e&&(i=s.attr("name")),i},this.destroy=function(){t(this.element).off(".JValidator"),delete this.element}}.call(s.prototype),function(){this.validate=function(){var t,e;return this.isFieldIgnored()||!this.isValidatorEnable()||!this.field.jValidator.validateInvisibleFileds&&!this.isFieldVisible()?!0:(t=this,e=t.pass,e&&h(e)&&e.abort(),o(t.method)?t.pass=t.method():t.pass=p[t.name].call(t),l(t.pass)||t.pass.done(function(e,i,s){t.pass=e.result,t.field.handleValidateResult(t,e.msg)}),t.field.handleValidateResult(t),t.pass)},this.value=function(){return this.field.value()},this.text=function(){return this.field.text()},this.isFieldIgnored=function(){return this.field.isIgnored()},this.isValidatorEnable=function(){return this.field.jValidator.isEnable()},this.root=function(){return this.field.root()},this.isFieldVisible=function(){return this.field.element.is(":visible")}}.call(r.prototype);var p={zipCode:function(){var t,e;return e=this.value(),t=!0,e&&(t=/^\d{6}$/.test(e)),t},number:function(){return p["int"].call(this)||p["float"].call(this)},"int":function(){var t,e=!0,i=this.value(),s=this.param[0];return t=s?/^\d+$/:/^[\+|-]?\d+$/,i&&(e=t.test(i)),e},"float":function(){var t,e=!0,i=this.value(),s=this.param[0];return t=s?/^\d+\.\d+$/:/^[\+|-]?\d+\.\d+$/,i&&(e=t.test(i)),e},email:function(){var t=!0,e=this.value();return e&&(t=/^\w+@\w+\.\w+$/.test(e)),t},required:function(){var t,e,i;return(t=this.field.isCheckbox(!0))?(i=this.root().find("[name="+t+"]:checked").length,e=!!i):(t=this.field.isRadio(!0))?(i=this.root().find("[name="+t+"]:checked").length,e=!!i):e=!!this.value(),e},max:function(){var t=this.value();return""===t?!0:Number(t)<=Number(this.param[0])},min:function(){var t=this.value();return""===t?!0:Number(t)>=Number(this.param[0])},maxLength:function(){var t,e,i;return t=!0,e=this.field.isCheckbox(!0),e?(i=this.root().find("[name="+e+"]:checked").length,i&&(t=i<=this.param[0]),this.msg||(this.msg="最多选择{0}个")):(i=String(this.value()),i&&(t=i.length<=this.param[0])),t},minLength:function(){var t,e,i;return t=!0,e=this.field.isCheckbox(!0),e?(i=this.root().find("[name="+e+"]:checked").length,t=i>=this.param[0],this.msg||(this.msg="至少选择{0}个")):(i=String(this.value()),i&&(t=i.length>=this.param[0])),t},mobile:function(){var t=!0,e=String(this.value());return e&&(t=/^1\d{10}$/.test(e)),t},idCard:function(){var e,i,s,r=0,n=!0,o=String(this.value());if(o){if(15==this.param[0]&&(n=/^\d{15}$/.test(o)))return n;n=/^\d{17}[\d|x|X]$/.test(o),n&&(e=Number(o.slice(6,10)),i=Number(o.slice(10,12)),s=Number(o.slice(12,14)),(i>12||1>i||s>a(i,e))&&(n=!1)),n&&(t.each(o.slice(0,-1).split(""),function(t,e){r+=Math.pow(2,17-t)*e}),r=Math.abs(r%11-12)%11,n=r==o.charAt(17)||"X"==o.charAt(17).toUpperCase()&&10==r)}return n},length:function(){var t,e,i;return t=!0,e=this.field.isCheckbox(!0),e?(i=this.root().find("[name="+e+"]:checked").length,i&&(t=i==this.param[0]),this.msg||(this.msg="只能选择{0}个")):(i=String(this.value()),i&&(t=i.length==this.param[0])),t},pattern:function(){var t,e,i;return t=!0,e=this.value(),e&&(i=new RegExp(this.param[0],this.param[1]),t=i.test(e)),t},sameTo:function(){var e,i;return e=!0,i=this.value(),i&&(e=i==t(this.param[0]).val()),e}},g=function(){var t,e=["0","0","0"],i="jRuleName";return t=function(){for(var t,s=e.length;s;){if(s--,t=e[s].charCodeAt(0),57==t)return e[s]="a",i+e.join("");if(122==t)return e[s]="A",i+e.join("");if(90!=t)return e[s]=String.fromCharCode(t+1),i+e.join("");e[s]="0"}return e.unshift("0"),i+e.join("")}}();return i});